<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vikas Public School</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;600;700&display=swap"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="css/style.css" />
  <style>
    /* Modern Global Styles */
    :root {
      --primary-color: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #a5b4fc;
      --secondary-color: #f59e0b;
      --accent-color: #10b981;
      --background: #fafbfc;
      --surface: #ffffff;
      --surface-elevated: #ffffff;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --text-muted: #9ca3af;
      --border: #e5e7eb;
      --border-light: #f3f4f6;
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --border-radius: 12px;
      --border-radius-lg: 16px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      line-height: 1.6;
      color: var(--text-primary);
      background: var(--background);
      overflow-x: hidden;
    }

    /* Modern Header */
    header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-light);
      transition: var(--transition);
    }

    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    /* Modern typography */
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Playfair Display', serif;
      font-weight: 600;
      line-height: 1.2;
      color: var(--text-primary);
    }

    /* Glass morphism effect for cards */
    .glass {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: var(--shadow-xl);
    }

    /* Modern button styles */
    .btn-modern {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
      background: var(--gradient-primary);
      color: white;
      text-decoration: none;
      border-radius: var(--border-radius);
      font-weight: 500;
      transition: var(--transition);
      border: none;
      cursor: pointer;
      box-shadow: var(--shadow-md);
    }

    .btn-modern:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    /* Loading animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* Intersection Observer animations */
    .animate-on-scroll {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .animate-on-scroll.visible {
      opacity: 1;
      transform: translateY(0);
    }
  </style>
  <!-- Include fontawesome icons for social -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous" defer></script>
  
  <!-- Firebase SDKs - Free Tier Optimized -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo-section">
        <img
          src="assets/logo.png"
          alt="Vikas Public School Logo"
          class="logo-img"
          aria-label="School Logo"
        />
        <div class="logo-text">
          <h1 class="school-name">Vikas Public School</h1>
        </div>
      </div>
      <div
        class="hamburger"
        role="button"
        aria-label="Toggle navigation menu"
        aria-expanded="false"
        tabindex="0"
        onclick="toggleMenu()"
        onkeypress="event.key === 'Enter' && toggleMenu()"
      >
        <span></span>
        <span></span>
        <span></span>
      </div>
      <nav class="main-nav" aria-label="Primary navigation">
        <ul class="nav-menu" id="menu">
          <li><a href="#" class="nav-link" tabindex="0">Home</a></li>
          <li><a href="#about" class="nav-link" tabindex="0">About</a></li>
          <li><a href="#academics" class="nav-link" tabindex="0">Academics</a></li>
          <li><a href="#gallery" class="nav-link" tabindex="0">Gallery</a></li>
          <li><a href="#admissions" class="nav-link" tabindex="0">Admissions</a></li>
          <li><a href="#contact" class="nav-link" tabindex="0">Contact</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="hero" role="banner" aria-label="Welcome message">
    Excellence in Education, Empowering Future Leaders
  </div>

  <main>
    <section class="section" id="about" tabindex="-1">
      <h2>About Us</h2>
      <p>
        Vikas Public School, established in 2004, is committed to nurturing young minds through
        holistic education. Our mission is to foster intellectual curiosity, critical thinking,
        and responsible citizenship through a dynamic curriculum and dedicated faculty. We
        strive to create lifelong learners and compassionate leaders, ready to make a positive
        impact in a rapidly changing world.
      </p>
      <div class="manager-profile" style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem;">
        <img src="assets/IMG-20250726-WA0016.jpg" alt="Jatashankar Pal, Manager" style="width:100px;height:100px;border-radius:50%;object-fit:cover;" />
        <div>
          <h3 style="margin:0;">Jatashankar Pal</h3>
          <p style="margin:0;">Manager</p>
        </div>
      </div>
      <div class="principal-profile" style="display:flex;align-items:center;gap:1rem;margin-bottom:1rem;">
        <img src="assets/IMG-20250726-WA0017.jpg" alt="Principal" style="width:100px;height:100px;border-radius:50%;object-fit:cover;" />
        <div>
          <h3 style="margin:0;">Principal</h3>
          <p style="margin:0;">Principal</p>
        </div>
      </div>
      <ul>
        <li>CBSE Affiliation with accredited standards</li>
        <li>Modern campus with smart classrooms, libraries, science labs, and sports facilities</li>
        <li>Focus on academics, co-curricular activities, and personal development</li>
        <li>Safe and inclusive learning environment</li>
      </ul>
      <div class="buttons">
        <a href="#admissions">Admissions</a>
        <a href="#contact">Contact Us</a>
      </div>
    </section>

    <section class="section" id="academics" tabindex="-1" aria-labelledby="academics-heading">
      <h2 id="academics-heading">Academics</h2>
      <p>
        At Vikas Public School, we offer a comprehensive curriculum that nurtures academic excellence and critical thinking skills.
      </p>
      <ul>
        <li><strong>Curriculum:</strong> CBSE syllabus from Nursery to Class XII.</li>
        <li><strong>Special Programs:</strong> STEM initiatives, Coding clubs, Language enrichment.</li>
        <li><strong>Assessment:</strong> Continuous Evaluation, Project Based Learning, Olympiads preparation.</li>
        <li><strong>Extra-Curricular:</strong> Art, Music, Dance, Debate, and Sports to nurture talents.</li>
      </ul>
    </section>

    <section class="section" id="faculty" tabindex="-1" aria-labelledby="faculty-heading">
      <h2 id="faculty-heading">Our Faculty</h2>
      <ul class="faculty-list" aria-live="polite">
        <li class="faculty-member">
          <img src="assets/faculty1.jpg" alt="Ms. Priya Sharma" class="faculty-photo" />
          <div class="faculty-info">
            <h3>Ms. Priya Sharma</h3>
            <p>Head of Science Department - 15 years of teaching experience and passion for student mentoring.</p>
          </div>
        </li>
        <li class="faculty-member">
          <img src="assets/faculty2.jpg" alt="Mr. Arjun Singh" class="faculty-photo" />
          <div class="faculty-info">
            <h3>Mr. Arjun Singh</h3>
            <p>Mathematics Teacher - Expert in advanced problem solving and Olympiad training.</p>
          </div>
        </li>
        <li class="faculty-member">
          <img src="assets/faculty3.jpg" alt="Mrs. Neha Verma" class="faculty-photo" />
          <div class="faculty-info">
            <h3>Mrs. Neha Verma</h3>
            <p>English Literature - Creative curriculum developer and drama club advisor.</p>
          </div>
        </li>
      </ul>
    </section>

    <section class="section" id="events" tabindex="-1" aria-labelledby="events-heading">
      <h2 id="events-heading">Events & News</h2>
      <ul class="events-list" aria-live="polite">
        <li class="event-item">
          <div class="event-info">
            <h3>Annual Sports Day - August 15, 2025</h3>
            <p>Join us for a day full of sportsmanship and fun activities for all students.</p>
          </div>
        </li>
        <li class="event-item">
          <div class="event-info">
            <h3>Science Exhibition - September 10, 2025</h3>
            <p>A platform for young innovators to showcase their projects and experiments.</p>
          </div>
        </li>
        <li class="event-item">
          <div class="event-info">
            <h3>Parent-Teacher Meeting - October 5, 2025</h3>
            <p>Discuss your child's progress and participate in school development feedback sessions.</p>
          </div>
        </li>
      </ul>
    </section>

    <section class="section" id="gallery" tabindex="-1" aria-labelledby="gallery-heading">
      <h2 id="gallery-heading">Gallery</h2>
      <div class="gallery" role="list" aria-label="School photo gallery">
        <a href="#" data-img="assets/gallery7.jpg" tabindex="0" role="listitem" class="gallery-link">
          <img src="assets/gallery7.jpg" alt="Science experiments in the school lab" />
        </a>
        <a href="#" data-img="assets/gallery8.jpg" tabindex="0" role="listitem" class="gallery-link">
          <img src="assets/gallery8.jpg" alt="School activity or event" />
        </a>
        <a href="#" data-img="assets/gallery9.jpg" tabindex="0" role="listitem" class="gallery-link">
          <img src="assets/gallery9.jpg" alt="School activity or event" />
        </a>
        <a href="#" data-img="assets/gallery10.jpg" tabindex="0" role="listitem" class="gallery-link">
          <img src="assets/gallery10.jpg" alt="School activity or event" />
        </a>
        <a href="#" data-img="assets/gallery11.jpg" tabindex="0" role="listitem" class="gallery-link">
          <img src="assets/gallery11.jpg" alt="School activity or event" />
        </a>
        <a href="#" data-img="assets/gallery12.jpg" tabindex="0" role="listitem" class="gallery-link">
          <img src="assets/gallery12.jpg" alt="School activity or event" />
        </a>
        <a href="#" data-img="assets/gallery13.jpg" tabindex="0" role="listitem" class="gallery-link">
          <img src="assets/gallery13.jpg" alt="School activity or event" />
        </a>
      </div>
      <!-- Modal for image viewing -->
      <div id="imgModal" class="modal" aria-modal="true" role="dialog" tabindex="-1" style="display:none;">
        <span class="close" id="modalClose" tabindex="0" aria-label="Close image modal">&times;</span>
        <img class="modal-content" id="modalImg" alt="Gallery image enlarged" />
      </div>
    </section>

    <section class="section" id="testimonials" tabindex="-1" aria-labelledby="testimonials-heading">
      <h2 id="testimonials-heading">Testimonials</h2>
      <ul class="testimonial-list" aria-live="polite">
        <li class="testimonial-item">
          <div class="testimonial-info">
            <h3>Ravi Kumar, Parent</h3>
            <p>
              "Vikas Public School has transformed my child's life with excellent academics and a nurturing environment."
            </p>
          </div>
        </li>
        <li class="testimonial-item">
          <div class="testimonial-info">
            <h3>Meera Singh, Student</h3>
            <p>
              "The teachers here are supportive and the activities are fun and enriching. I love being part of the school."
            </p>
          </div>
        </li>
        <li class="testimonial-item">
          <div class="testimonial-info">
            <h3>Anita Joshi, Parent</h3>
            <p>
              "Strong focus on all-round development helped my daughter flourish in academics and sports."
            </p>
          </div>
        </li>
      </ul>
    </section>

    <section class="section" id="faq" tabindex="-1" aria-labelledby="faq-heading">
      <h2 id="faq-heading">Frequently Asked Questions</h2>
      <ul class="faq-list" role="list">
        <li class="faq-item">
          <button class="faq-question" aria-expanded="false" aria-controls="faq1" id="faq1-btn">
            What is the admission process?
          </button>
          <div class="faq-answer" id="faq1" role="region" aria-labelledby="faq1-btn">
            We have an application followed by an entrance test and interview. Detailed steps are available in the Admissions section.
          </div>
        </li>
        <li class="faq-item">
          <button class="faq-question" aria-expanded="false" aria-controls="faq2" id="faq2-btn">
            Do you offer transportation facilities?
          </button>
          <div class="faq-answer" id="faq2" role="region" aria-labelledby="faq2-btn">
            Yes, we provide safe and reliable transport services covering major areas of Bengaluru.
          </div>
        </li>
        <li class="faq-item">
          <button class="faq-question" aria-expanded="false" aria-controls="faq3" id="faq3-btn">
            What co-curricular activities are available?
          </button>
          <div class="faq-answer" id="faq3" role="region" aria-labelledby="faq3-btn">
            Students can participate in sports, music, dance, arts, debate, coding clubs, and more.
          </div>
        </li>
      </ul>
    </section>

    <section class="section" id="admissions" tabindex="-1" aria-labelledby="admissions-heading">
      <h2 id="admissions-heading">Admissions</h2>
      <p>
        Admissions open for academic year 2025-26. Registration forms are available online and at
        our campus.
      </p>
      <p><strong>Eligibility:</strong> Nursery to Class XII</p>
      <p>
        <strong>Process:</strong> Application &rarr; Entrance Test &rarr; Interview &rarr; Admission
        Confirmation
      </p>
      <p>
        <strong>Required Documents:</strong> Birth Certificate, Previous Yearâ€™s Marksheet,
        Passport-size Photographs, Address Proof.
      </p>
      <div class="cta-wrapper">
        <button onclick="alert('Admission form will be available soon. Please contact the school office.')" class="cta-button">Get Admission Form</button>
      </div>
    </section>

    <section class="section" id="contact" tabindex="-1" aria-labelledby="contact-heading">
      <h2 id="contact-heading">Contact Us</h2>
      <address>
        <p><strong>Address:</strong> Jaunpur, UP India 222146</p>
        <p><strong>Email:</strong> <a href="mailto:info@vikasschool.edu.in">info@vikasschool.edu.in</a></p>
        <p><strong>Phone:</strong> +91-98765 43210</p>
        <p><strong>Office Hours:</strong> 9 AM â€“ 4 PM, Monday to Saturday</p>
      </address>
      <form
        action="#"
        method="post"
        aria-label="Contact form"
        onsubmit="return handleSubmit(event)"
        novalidate
      >
        <input
          type="text"
          name="name"
          id="name"
          placeholder="Your Name"
          required
          aria-required="true"
          aria-describedby="name-error"
        />
        <span id="name-error" style="color:#d32f2f; font-size:0.85rem; display:none;"
          >Please enter your name.</span
        >

        <input
          type="email"
          name="email"
          id="email"
          placeholder="Your Email"
          required
          aria-required="true"
          aria-describedby="email-error"
        />
        <span id="email-error" style="color:#d32f2f; font-size:0.85rem; display:none;"
          >Please enter a valid email.</span
        >

        <textarea
          name="message"
          id="message"
          rows="4"
          placeholder="Your Message"
          aria-describedby="message-help"
        ></textarea>
        <small id="message-help" style="color:#666;">Optional</small>

        <button type="submit">Send Message</button>
      </form>
    </section>
  </main>

  <footer>
    <div class="footer-container">
      <div class="social-icons" aria-label="Social media links">
        <a href="https://facebook.com" target="_blank" rel="noopener" aria-label="Facebook" tabindex="0">
          <i class="fab fa-facebook"></i>
        </a>
        <a href="https://twitter.com" target="_blank" rel="noopener" aria-label="Twitter" tabindex="0">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="https://instagram.com" target="_blank" rel="noopener" aria-label="Instagram" tabindex="0">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://linkedin.com" target="_blank" rel="noopener" aria-label="LinkedIn" tabindex="0">
          <i class="fab fa-linkedin"></i>
        </a>
      </div>
      <div class="quick-links" aria-label="Quick links">
        <a href="#about" tabindex="0">About</a> |
        <a href="#academics" tabindex="0">Academics</a> |
        <a href="#admissions" tabindex="0">Admissions</a> |
        <a href="#contact" tabindex="0">Contact</a>
      </div>
    </div>
    <div style="margin-top:0.8rem;">&copy; 2025 Vikas Public School, Jaunpur. All Rights Reserved.</div>
  </footer>

  <script src="js/main.js"></script>
  
  <!-- Firebase Configuration - Free Tier Optimized -->
  <script>
    // Wait for DOM to be fully loaded before running Firebase code
    document.addEventListener('DOMContentLoaded', function() {
      // Firebase configuration for free tier
      const firebaseConfig = {
        apiKey: "AIzaSyDZH0ZcGAtrILqdRdI5dIhZCUA0eAJzRpE",
        authDomain: "vpschool-918d6.firebaseapp.com",
        projectId: "vpschool-918d6",
        storageBucket: "vpschool-918d6.firebasestorage.app",
        messagingSenderId: "290237090155",
        appId: "1:290237090155:web:90356cb12d25d5a0a8a42e",
        measurementId: "G-02JK84S8NH"
      };
      
      // Initialize Firebase for main website
      let db;
      if (typeof firebase !== 'undefined') {
        try {
          firebase.initializeApp(firebaseConfig);
          db = firebase.firestore();
          
          // Enable offline persistence for free tier efficiency
          db.enablePersistence({ synchronizeTabs: true })
            .then(() => {
              console.log('Firebase persistence enabled - optimized for free tier!');
            })
            .catch(() => {
              console.log('Persistence not available in this browser');
            });
          
          console.log('Firebase initialized for main website');
          
          // Load dynamic content efficiently
          loadDynamicContent();
        } catch (error) {
          console.log('Firebase not available, using static content');
        }
      }
      
      // Enhanced cache checking function
      async function shouldUseCache(type, cachedTime, now, CACHE_DURATION) {
        // First check if cache is within time limit
        if (!cachedTime || (now - cachedTime >= CACHE_DURATION)) {
          return false;
        }
        
        try {
          // Check if admin has invalidated this cache
          const cacheDoc = await db.collection('cache').doc(type).get();
          if (cacheDoc.exists) {
            const cacheInfo = cacheDoc.data();
            const lastUpdated = cacheInfo.lastUpdated;
            
            // If admin updated content after our cache, invalidate it
            if (lastUpdated > cachedTime) {
              console.log(`Cache invalidated for ${type} - admin updated content`);
              return false;
            }
          }
          
          return true;
        } catch (error) {
          console.log(`Error checking cache invalidation for ${type}, using time-based cache:`, error);
          return (now - cachedTime < CACHE_DURATION);
        }
      }

      // Free tier optimized data loading with auto-invalidation
      async function loadDynamicContent() {
        try {
          const now = Date.now();
          const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours
          
          // Load faculty data with smart caching
          const facultyCache = localStorage.getItem('facultyData');
          const facultyCacheTime = parseInt(localStorage.getItem('facultyCacheTime'));
          
          if (facultyCache && await shouldUseCache('faculty', facultyCacheTime, now, CACHE_DURATION)) {
            // Use cached data to minimize reads
            console.log('Using cached faculty data');
            updateFacultySection(JSON.parse(facultyCache));
          } else {
            // Fetch fresh data only when needed
            console.log('Fetching fresh faculty data');
            const facultySnapshot = await db.collection('faculty').get();
            const facultyData = facultySnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
            
            // Cache the data
            localStorage.setItem('facultyData', JSON.stringify(facultyData));
            localStorage.setItem('facultyCacheTime', now.toString());
            
            console.log('Faculty data loaded:', facultyData); // Debug log
            updateFacultySection(facultyData);
          }
          
          // Load testimonials with smart caching
          const testimonialsCache = localStorage.getItem('testimonialsData');
          const testimonialsCacheTime = parseInt(localStorage.getItem('testimonialsCacheTime'));
          
          if (testimonialsCache && await shouldUseCache('testimonials', testimonialsCacheTime, now, CACHE_DURATION)) {
            console.log('Using cached testimonials data');
            updateTestimonialsSection(JSON.parse(testimonialsCache));
          } else {
            console.log('Fetching fresh testimonials data');
            const testimonialsSnapshot = await db.collection('testimonials').get();
            const testimonialsData = testimonialsSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
            
            localStorage.setItem('testimonialsData', JSON.stringify(testimonialsData));
            localStorage.setItem('testimonialsCacheTime', now.toString());
            
            updateTestimonialsSection(testimonialsData);
          }
          
          // Load gallery data with smart caching
          const galleryCache = localStorage.getItem('galleryData');
          const galleryCacheTime = parseInt(localStorage.getItem('galleryCacheTime'));
          
          if (galleryCache && await shouldUseCache('gallery', galleryCacheTime, now, CACHE_DURATION)) {
            console.log('Using cached gallery data');
            updateGallerySection(JSON.parse(galleryCache));
          } else {
            console.log('Fetching fresh gallery data');
            const gallerySnapshot = await db.collection('gallery').get();
            const galleryData = gallerySnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
            
            localStorage.setItem('galleryData', JSON.stringify(galleryData));
            localStorage.setItem('galleryCacheTime', now.toString());
            
            updateGallerySection(galleryData);
          }
          
          // Load events data with smart caching
          const eventsCache = localStorage.getItem('eventsData');
          const eventsCacheTime = parseInt(localStorage.getItem('eventsCacheTime'));
          
          if (eventsCache && await shouldUseCache('events', eventsCacheTime, now, CACHE_DURATION)) {
            console.log('Using cached events data');
            updateEventsSection(JSON.parse(eventsCache));
          } else {
            console.log('Fetching fresh events data');
            const eventsSnapshot = await db.collection('events').get();
            const eventsData = eventsSnapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
            
            localStorage.setItem('eventsData', JSON.stringify(eventsData));
            localStorage.setItem('eventsCacheTime', now.toString());
            
            updateEventsSection(eventsData);
          }
          
          // Load hero section data
          await loadSettingsData('hero', updateHeroSection);
          
          // Load about section data
          await loadSettingsData('about', updateAboutSection);
          
          // Load school info data
          await loadSettingsData('school-info', updateSchoolInfoSection);
          
          // Load contact data
          await loadSettingsData('contact', updateContactSection);
          
        } catch (error) {
          console.log('Error loading dynamic content, using static fallback:', error);
        }
      }
      
      // Make loadDynamicContent globally accessible
      window.loadDynamicContent = loadDynamicContent;
      
      // Helper function to load settings data (hero, about, school-info, contact)
      async function loadSettingsData(type, updateFunction) {
        try {
          const now = Date.now();
          const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours
          
          const cacheKey = `${type}Data`;
          const cacheTimeKey = `${type}CacheTime`;
          
          const cachedData = localStorage.getItem(cacheKey);
          const cacheTime = parseInt(localStorage.getItem(cacheTimeKey));
          
          if (cachedData && await shouldUseCache(type, cacheTime, now, CACHE_DURATION)) {
            console.log(`Using cached ${type} data`);
            updateFunction(JSON.parse(cachedData));
          } else {
            console.log(`Fetching fresh ${type} data`);
            const docSnapshot = await db.collection('settings').doc(type).get();
            
            if (docSnapshot.exists) {
              const data = docSnapshot.data();
              
              // Cache the data
              localStorage.setItem(cacheKey, JSON.stringify(data));
              localStorage.setItem(cacheTimeKey, now.toString());
              
              updateFunction(data);
            } else {
              console.log(`No ${type} data found in database`);
            }
          }
        } catch (error) {
          console.log(`Error loading ${type} data:`, error);
        }
      }
      
      // Force refresh function for immediate updates - make it globally accessible
      window.forceRefreshContent = function() {
        console.log('Force refreshing all content...');
        
        // Clear all cache
        localStorage.removeItem('facultyData');
        localStorage.removeItem('facultyCacheTime');
        localStorage.removeItem('testimonialsData');
        localStorage.removeItem('testimonialsCacheTime');
        localStorage.removeItem('galleryData');
        localStorage.removeItem('galleryCacheTime');
        localStorage.removeItem('eventsData');
        localStorage.removeItem('eventsCacheTime');
        localStorage.removeItem('heroData');
        localStorage.removeItem('heroCacheTime');
        localStorage.removeItem('aboutData');
        localStorage.removeItem('aboutCacheTime');
        localStorage.removeItem('school-infoData');
        localStorage.removeItem('school-infoCacheTime');
        localStorage.removeItem('contactData');
        localStorage.removeItem('contactCacheTime');
        
        // Reload content
        if (typeof window.loadDynamicContent === 'function') {
          window.loadDynamicContent();
        }
        
        // Show user feedback
        if (typeof window.showUpdateNotification === 'function') {
          window.showUpdateNotification('Content refreshed successfully!');
        }
      };
      
      // Show update notification - make it globally accessible
      window.showUpdateNotification = function(message) {
        // Create notification element
        const notification = document.createElement('div');
        notification.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: #10b981;
          color: white;
          padding: 12px 20px;
          border-radius: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.1);
          z-index: 1000;
          font-family: inherit;
          font-size: 14px;
          opacity: 0;
          transform: translateX(100%);
          transition: all 0.3s ease;
        `;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        // Show notification
        setTimeout(() => {
          notification.style.opacity = '1';
          notification.style.transform = 'translateX(0)';
        }, 100);
        
        // Hide and remove notification
        setTimeout(() => {
          notification.style.opacity = '0';
          notification.style.transform = 'translateX(100%)';
          setTimeout(() => {
            if (notification.parentNode) {
              notification.parentNode.removeChild(notification);
            }
          }, 300);
        }, 3000);
      };
      
      // Add keyboard shortcut for force refresh (Ctrl+Shift+R)
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.shiftKey && e.key === 'R') {
          e.preventDefault();
          if (typeof window.forceRefreshContent === 'function') {
            window.forceRefreshContent();
          }
        }
      });
      
      function updateFacultySection(facultyData) {
        const facultyList = document.querySelector('.faculty-list');
        if (facultyList && facultyData.length > 0) {
          facultyList.innerHTML = facultyData.map(faculty => {
            // Handle both regular URLs and base64 data URLs
            const photoSrc = faculty.photo || 'assets/faculty1.jpg'; // fallback image
            const safeName = (faculty.name || 'Faculty Member').replace(/"/g, '&quot;');
            const safeRole = (faculty.role || 'Staff').replace(/"/g, '&quot;');
            const safeDescription = (faculty.description || '').replace(/"/g, '&quot;');
            
            return `
            <li class="faculty-member">
              <img src="${photoSrc}" alt="${safeName}" class="faculty-photo" 
                   onerror="this.src='assets/faculty1.jpg'; console.log('Faculty image failed to load, using fallback');" />
              <div class="faculty-info">
                <h3>${safeName}</h3>
                <p>${safeRole}${safeDescription ? ' - ' + safeDescription : ''}</p>
              </div>
            </li>
          `;
          }).join('');
        }
      }
      
      function updateTestimonialsSection(testimonialsData) {
        const testimonialsList = document.querySelector('.testimonial-list');
        if (testimonialsList && testimonialsData.length > 0) {
          testimonialsList.innerHTML = testimonialsData.map(testimonial => `
            <li class="testimonial-item">
              <div class="testimonial-info">
                <h3>${testimonial.name}, ${testimonial.role}</h3>
                <p>"${testimonial.text}"</p>
              </div>
            </li>
          `).join('');
        }
      }
      
      function updateGallerySection(galleryData) {
        const gallery = document.querySelector('.gallery');
        if (gallery && galleryData.length > 0) {
          gallery.innerHTML = galleryData.map(item => {
            // Handle both regular URLs and base64 data URLs
            const imageSrc = item.src || 'assets/gallery7.jpg'; // fallback image
            const safeAlt = (item.alt || 'Gallery image').replace(/"/g, '&quot;');
            
            return `
            <a href="#" data-img="${imageSrc}" tabindex="0" role="listitem" class="gallery-link">
              <img src="${imageSrc}" alt="${safeAlt}" 
                   onerror="this.src='assets/gallery7.jpg'; console.log('Gallery image failed to load, using fallback');" />
            </a>
          `;
          }).join('');
          
          // Re-attach gallery click events after updating content
          setTimeout(() => {
            if (window.attachGalleryEvents) {
              window.attachGalleryEvents();
            }
          }, 100);
        }
      }
      
      // Update functions for admin panel sections
      function updateHeroSection(heroData) {
        const heroElement = document.querySelector('.hero');
        if (heroElement && heroData) {
          // Update hero text
          if (heroData.title || heroData.subtitle) {
            const title = heroData.title || 'Vikas Public School';
            const subtitle = heroData.subtitle || 'Excellence in Education';
            heroElement.textContent = `${title} - ${subtitle}`;
          }
          
          // Update background image if provided
          if (heroData.backgroundImage) {
            heroElement.style.backgroundImage = `url(${heroData.backgroundImage})`;
            heroElement.style.backgroundSize = 'cover';
            heroElement.style.backgroundPosition = 'center';
          }
        }
      }
      
      function updateAboutSection(aboutData) {
        const aboutSection = document.getElementById('about');
        if (aboutSection && aboutData) {
          // Find the main content paragraph (first p tag)
          const mainParagraph = aboutSection.querySelector('p');
          if (mainParagraph && aboutData.content) {
            mainParagraph.textContent = aboutData.content;
          }
          
          // Add mission and vision if they exist
          let existingMissionVision = aboutSection.querySelector('.mission-vision');
          if (existingMissionVision) {
            existingMissionVision.remove();
          }
          
          if (aboutData.mission || aboutData.vision) {
            const missionVisionDiv = document.createElement('div');
            missionVisionDiv.className = 'mission-vision';
            missionVisionDiv.style.marginTop = '1rem';
            
            let content = '';
            if (aboutData.mission) {
              content += `<div style="margin-bottom: 1rem;"><strong>Mission:</strong> ${aboutData.mission}</div>`;
            }
            if (aboutData.vision) {
              content += `<div><strong>Vision:</strong> ${aboutData.vision}</div>`;
            }
            
            missionVisionDiv.innerHTML = content;
            
            // Insert after the main paragraph
            if (mainParagraph) {
              mainParagraph.parentNode.insertBefore(missionVisionDiv, mainParagraph.nextSibling);
            }
          }
        }
      }
      
      function updateSchoolInfoSection(schoolData) {
        // Update header title if school name is provided
        if (schoolData && schoolData.name) {
          const headerTitle = document.querySelector('header h1');
          if (headerTitle) {
            headerTitle.textContent = schoolData.name;
          }
          
          // Update page title
          document.title = schoolData.name;
        }
      }
      
      function updateContactSection(contactData) {
        const contactSection = document.getElementById('contact');
        if (contactSection && contactData) {
          const address = contactSection.querySelector('address');
          if (address) {
            let addressHTML = '';
            
            if (contactData.address) {
              addressHTML += `<p><strong>Address:</strong> ${contactData.address}</p>`;
            }
            if (contactData.email) {
              addressHTML += `<p><strong>Email:</strong> <a href="mailto:${contactData.email}">${contactData.email}</a></p>`;
            }
            if (contactData.phone) {
              addressHTML += `<p><strong>Phone:</strong> ${contactData.phone}</p>`;
            }
            if (contactData.hours) {
              addressHTML += `<p><strong>Office Hours:</strong> ${contactData.hours}</p>`;
            }
            
            // Only update if we have some data
            if (addressHTML) {
              address.innerHTML = addressHTML;
            }
          }
        }
      }
      
      function updateEventsSection(eventsData) {
        const eventsList = document.querySelector('.events-list');
        if (eventsList && eventsData.length > 0) {
          eventsList.innerHTML = eventsData.map(event => {
            const safeTitle = (event.title || 'Event').replace(/"/g, '&quot;');
            const safeDate = (event.date || '').replace(/"/g, '&quot;');
            const safeDescription = (event.description || '').replace(/"/g, '&quot;');
            
            return `
            <li class="event-item">
              <div class="event-info">
                <h3>${safeTitle}${safeDate ? ' - ' + safeDate : ''}</h3>
                <p>${safeDescription}</p>
              </div>
            </li>
          `;
          }).join('');
        }
      }
      
      // Helper function to clear cache for testing (call from browser console)
      window.clearDynamicContentCache = function() {
        localStorage.removeItem('facultyData');
        localStorage.removeItem('facultyCacheTime');
        localStorage.removeItem('testimonialsData');
        localStorage.removeItem('testimonialsCacheTime');
        localStorage.removeItem('galleryData');
        localStorage.removeItem('galleryCacheTime');
        localStorage.removeItem('eventsData');
        localStorage.removeItem('eventsCacheTime');
        localStorage.removeItem('heroData');
        localStorage.removeItem('heroCacheTime');
        localStorage.removeItem('aboutData');
        localStorage.removeItem('aboutCacheTime');
        localStorage.removeItem('school-infoData');
        localStorage.removeItem('school-infoCacheTime');
        localStorage.removeItem('contactData');
        localStorage.removeItem('contactCacheTime');
        console.log('All cache cleared! Reload the page to see fresh data.');
      };
    });
  </script>

  <!-- Floating Refresh Button -->
  <button 
    id="refresh-fab" 
    class="refresh-fab"
    onclick="window.forceRefreshContent && window.forceRefreshContent()" 
    title="Refresh content (Ctrl+Shift+R)"
  >
    ðŸ”„
  </button>

</body>
</html>
